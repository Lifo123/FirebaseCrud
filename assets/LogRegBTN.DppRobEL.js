import{j as d}from"./jsx-runtime.CdUEbdov.js";import{c as g,r as c,g as u,s as p}from"./index.esm2017.enH01Utu.js";import{d as f,a as w}from"./firebase.J1YtV1My.js";import{h as m,g as h}from"./Hashing.Co_4HAtW.js";import{r as y}from"./index.YZ_XhM9s.js";import{J as s}from"./_astro-entry_sonner.BrdQ6kbN.js";import"./index.CTAGWh-w.js";const v=async(a,o)=>{g(w,"login",{method:"username",userId:a});const n=c(f,`users/${a}`),t=await u(n);if(t.exists()){const e=t.val(),r=m(o,e?.salt);return e.password===r?[!0,{user:a,salt:e.salt}]:"Contraseña incorrecta"}else return!1},S=async(a,o,n)=>{try{const t=c(f,`users/${a}`),e=await u(t),r=new Date().getTime();return e.exists()?"exists":(await p(t,{user:a,password:o,salt:n,createAt:r}),"created")}catch(t){return console.log(t),"error"}};function R({mode:a}){const o=async()=>{const e=t();if(e[0].value===""||e[1].value===""){s.dismiss(),s.error("Please fill all the fields");return}else s.dismiss();const r=await v(e[0].value,e[1].value);Array.isArray(r)&&r[0]===!0?(localStorage.setItem("F-User",JSON.stringify({user:r[1].user,salt:r[1].salt})),window.location.href="/FirebaseCrud/"):r==="Contraseña incorrecta"?s.error("Contraseña incorrecta"):r===!1&&s.error("User not found")},n=async()=>{const e=t();if(e[0].value===""||e[1].value===""||e[2].value===""){s.dismiss(),s.error("Please fill all the fields");return}else s.dismiss();if(e[1].value!==e[2].value){s.dismiss(),s.error("Passwords do not match");return}let r=h(),i=m(e[1].value,r),l=await S(e[0].value,i,r);if(l==="created"){localStorage.setItem("F-User",JSON.stringify({user:e[0].value,salt:r})),window.location.href="/FirebaseCrud/";return}else l==="exists"?s.error("User already exists"):l==="error"&&s.error("Error creating user")},t=()=>{const e=document.querySelector('[name="username"]'),r=document.querySelector('[name="password"]'),i=document.querySelector('[name="password1"]'),l=document.querySelector('[name="remember"]');return[e,r,i,l]};return y.useEffect(()=>{t().forEach(r=>{r?.addEventListener("keydown",i=>{i.key==="Enter"&&(a==="login"?o():n())})})},[]),d.jsx("span",{className:"logreg-btn d-flex br-6 pointer mt-3 mb-1 fw-600 f-justify-center",onClick:a==="login"?o:n,children:a==="login"?"Sign In":"Sing Up"})}export{R as default};
