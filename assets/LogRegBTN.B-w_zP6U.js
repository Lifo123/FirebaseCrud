import{j as q}from"./jsx-runtime.CdUEbdov.js";import{r as A,d as E,g as C,s as F}from"./firebase.DLoNNVt7.js";import{r as J}from"./index.YZ_XhM9s.js";import{J as c}from"./_astro-entry_sonner.BrdQ6kbN.js";import"./index.CTAGWh-w.js";const L=(a=6)=>{const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=new Uint8Array(a);window?.crypto.getRandomValues(i);let e="";for(let t=0;t<a;t++)e+=n.charAt(i[t]%n.length);return e},R=(a,n)=>{const i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],t=new TextEncoder().encode(a+n),r=t.length,l=r+9+63&-64,o=new Uint8Array(l);o.set(t),o[r]=128,o[l-8]=r*8>>24,o[l-7]=r*8>>16,o[l-6]=r*8>>8,o[l-5]=r*8&255;for(let g=0;g<o.length;g+=64){const w=o.subarray(g,g+64),u=new Uint32Array(64);for(let s=0;s<16;s++)u[s]=w[s*4]<<24|w[s*4+1]<<16|w[s*4+2]<<8|w[s*4+3];for(let s=16;s<64;s++){const U=d(u[s-15],7)^d(u[s-15],18)^u[s-15]>>>3,b=d(u[s-2],17)^d(u[s-2],19)^u[s-2]>>>10;u[s]=u[s-16]+U+u[s-7]+b|0}let f=e[0],p=e[1],h=e[2],v=e[3],m=e[4],y=e[5],S=e[6],x=e[7];for(let s=0;s<64;s++){const U=d(m,6)^d(m,11)^d(m,25),b=m&y^~m&S,j=x+U+b+i[s]+u[s]|0,P=d(f,2)^d(f,13)^d(f,22),k=f&p^f&h^p&h,D=P+k|0;x=S,S=y,y=m,m=v+j|0,v=h+D|0,h=p,p=f,f=j+D|0}e[0]=e[0]+f|0,e[1]=e[1]+p|0,e[2]=e[2]+h|0,e[3]=e[3]+v|0,e[4]=e[4]+m|0,e[5]=e[5]+y|0,e[6]=e[6]+S|0,e[7]=e[7]+x|0}return e.map(g=>("00000000"+g.toString(16)).slice(-10)).join("").replaceAll("-","x")},d=(a,n)=>(a>>>n|a<<32-n)>>>0,N=async(a,n)=>{const i=A(E,`users/${a}`),e=await C(i);if(e.exists()){const t=e.val(),r=R(n,t?.salt);return t.password===r?[!0,{user:a,salt:t.salt}]:"Contraseña incorrecta"}else return!1},T=async(a,n,i)=>{try{const e=A(E,`users/${a}`),t=await C(e),r=new Date().getTime();return t.exists()?"exists":(await F(e,{user:a,password:n,salt:i,createAt:r}),"created")}catch{return"error"}};function V({mode:a}){const n=async()=>{const t=e();if(t[0].value===""||t[1].value===""){c.dismiss(),c.error("Please fill all the fields");return}else c.dismiss();const r=await N(t[0].value,t[1].value);Array.isArray(r)&&r[0]===!0?(localStorage.setItem("F-User",JSON.stringify({user:r[1].user,salt:r[1].salt})),window.location.href="/FirebaseCrud/"):r==="Contraseña incorrecta"?c.error("Contraseña incorrecta"):r===!1&&c.error("User not found")},i=async()=>{const t=e();if(t[0].value===""||t[1].value===""||t[2].value===""){c.dismiss(),c.error("Please fill all the fields");return}else c.dismiss();if(t[1].value!==t[2].value){c.dismiss(),c.error("Passwords do not match");return}let r=L(),l=R(t[1].value,r),o=await T(t[0].value,l,r);if(o==="created"){localStorage.setItem("F-User",JSON.stringify({user:t[0].value,salt:r})),window.location.href="/FirebaseCrud/";return}else o==="exists"?c.error("User already exists"):o==="error"&&c.error("Error creating user")},e=()=>{const t=document.querySelector('[name="username"]'),r=document.querySelector('[name="password"]'),l=document.querySelector('[name="password1"]'),o=document.querySelector('[name="remember"]');return[t,r,l,o]};return J.useEffect(()=>{e().forEach(r=>{r?.addEventListener("keydown",l=>{l.key==="Enter"&&(a==="login"?n():i())})})},[]),q.jsx("span",{className:"logreg-btn d-flex br-6 pointer mt-3 mb-1 fw-600 f-justify-center",onClick:a==="login"?n:i,children:a==="login"?"Sign In":"Sing Up"})}export{V as default};
