import{j as q}from"./jsx-runtime.CdUEbdov.js";import{c as J,r as b,g as A,s as L}from"./index.esm2017.enH01Utu.js";import{d as R,a as N}from"./firebase.J1YtV1My.js";import{r as T}from"./index.YZ_XhM9s.js";import{J as l}from"./_astro-entry_sonner.BrdQ6kbN.js";import"./index.CTAGWh-w.js";const F=(a=6)=>{const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=new Uint8Array(a);window?.crypto.getRandomValues(i);let e="";for(let t=0;t<a;t++)e+=n.charAt(i[t]%n.length);return e},C=(a,n)=>{const i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],t=new TextEncoder().encode(a+n),r=t.length,c=r+9+63&-64,o=new Uint8Array(c);o.set(t),o[r]=128,o[c-8]=r*8>>24,o[c-7]=r*8>>16,o[c-6]=r*8>>8,o[c-5]=r*8&255;for(let g=0;g<o.length;g+=64){const w=o.subarray(g,g+64),u=new Uint32Array(64);for(let s=0;s<16;s++)u[s]=w[s*4]<<24|w[s*4+1]<<16|w[s*4+2]<<8|w[s*4+3];for(let s=16;s<64;s++){const U=f(u[s-15],7)^f(u[s-15],18)^u[s-15]>>>3,j=f(u[s-2],17)^f(u[s-2],19)^u[s-2]>>>10;u[s]=u[s-16]+U+u[s-7]+j|0}let d=e[0],h=e[1],p=e[2],v=e[3],m=e[4],y=e[5],S=e[6],x=e[7];for(let s=0;s<64;s++){const U=f(m,6)^f(m,11)^f(m,25),j=m&y^~m&S,D=x+U+j+i[s]+u[s]|0,P=f(d,2)^f(d,13)^f(d,22),k=d&h^d&p^h&p,E=P+k|0;x=S,S=y,y=m,m=v+D|0,v=p+E|0,p=h,h=d,d=D+E|0}e[0]=e[0]+d|0,e[1]=e[1]+h|0,e[2]=e[2]+p|0,e[3]=e[3]+v|0,e[4]=e[4]+m|0,e[5]=e[5]+y|0,e[6]=e[6]+S|0,e[7]=e[7]+x|0}return e.map(g=>("00000000"+g.toString(16)).slice(-10)).join("").replaceAll("-","x")},f=(a,n)=>(a>>>n|a<<32-n)>>>0,G=async(a,n)=>{J(N,"login",{method:"username",userId:a});const i=b(R,`users/${a}`),e=await A(i);if(e.exists()){const t=e.val(),r=C(n,t?.salt);return t.password===r?[!0,{user:a,salt:t.salt}]:"Contraseña incorrecta"}else return!1},I=async(a,n,i)=>{try{const e=b(R,`users/${a}`),t=await A(e),r=new Date().getTime();return t.exists()?"exists":(await L(e,{user:a,password:n,salt:i,createAt:r}),"created")}catch(e){return console.log(e),"error"}};function $({mode:a}){const n=async()=>{const t=e();if(t[0].value===""||t[1].value===""){l.dismiss(),l.error("Please fill all the fields");return}else l.dismiss();const r=await G(t[0].value,t[1].value);Array.isArray(r)&&r[0]===!0?(localStorage.setItem("F-User",JSON.stringify({user:r[1].user,salt:r[1].salt})),document.referrer?window.location.href=document.referrer:window.location.href="/Games/"):r==="Contraseña incorrecta"?l.error("Contraseña incorrecta"):r===!1&&l.error("User not found")},i=async()=>{const t=e();if(t[0].value===""||t[1].value===""||t[2].value===""){l.dismiss(),l.error("Please fill all the fields");return}else l.dismiss();if(t[1].value!==t[2].value){l.dismiss(),l.error("Passwords do not match");return}let r=F(),c=C(t[1].value,r),o=await I(t[0].value,c,r);if(o==="created"){localStorage.setItem("F-User",JSON.stringify({user:t[0].value,salt:r})),document.referrer?window.location.href=document.referrer:window.location.href="/Games/";return}else o==="exists"?l.error("User already exists"):o==="error"&&l.error("Error creating user")},e=()=>{const t=document.querySelector('[name="username"]'),r=document.querySelector('[name="password"]'),c=document.querySelector('[name="password1"]'),o=document.querySelector('[name="remember"]');return[t,r,c,o]};return T.useEffect(()=>{e().forEach(r=>{r?.addEventListener("keydown",c=>{c.key==="Enter"&&(a==="login"?n():i())})})},[]),q.jsx("span",{className:"logreg-btn d-flex br-6 pointer mt-3 mb-1 fw-600 f-justify-center",onClick:a==="login"?n:i,children:a==="login"?"Sign In":"Sing Up"})}export{$ as default};
